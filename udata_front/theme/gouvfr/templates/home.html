{% extends theme('base.html') %}

{% set meta = {
    'title': _('Home'),
    'description': _("%(site)s home", site=config['SITE_TITLE']),
    'keywords': [_('home')],
} %}

{% set read_only_mode = config.READ_ONLY_MODE %}

{% block content %}
{% cache cache_duration, 'home', g.lang_code %}

<section class="hero py-xl py-lg-lg">
    <div class="hagrid">
        <div class="row">
            <div class="col-5 col-lg-12">
                <h1 class="mt-0 mb-md-md">{{ _('Open platform for French public data') }}</h1>
                <div class="mt-md mt-lg-sm">
                    <h4>{{ _('Featured topics') }}</h4>
                    <a href="{{ url_for('gouvfr.show_page', slug='donnees-des-elections') }}"
                        class="btn-venti my-md bg-blue-400">
                        Données relatives aux
                        <strong>Élections</strong>
                    </a>
                    <a href="{{ url_for('gouvfr.show_page', slug='donnees-geographiques') }}"
                        class="btn-venti my-md bg-blue-450">
                        Données à composante
                        <strong>Géographique</strong>
                    </a>
                    <a href="{{ url_for('gouvfr.show_page', slug='donnees-logement-urbanisme') }}"
                        class="btn-venti bg-green-400">
                        Données relatives au
                        <strong>Logement et à l'Urbanisme</strong>
                    </a>
                    <div class="row justify-center mt-md">
                        <a
                            href="{{ url_for('gouvfr.show_page', slug='donnees-cles-par-sujet') }}"
                            class="fr-btn fr-btn--secondary fr-fi-arrow-right-s-line fr-btn--icon-right"
                        >
                            {{ _('All featured topics') }}
                        </a>
                    </div>
                </div>
            </div>
            <div class="col-6 offset-1 offset-lg-0 col-lg-12 mt-lg-md">
                <h4>{{ _('News') }}</h4>
                {% if last_post %}
                {% set post = last_post %}
                <a href="{{ post.display_url }}" title="{{ post.name }}" class="unstyled w-100 hero-post">
                    {% include theme('post/search-result.html') %}
                </a>
                <div class="row justify-center">
                    <a
                        href="{{ url_for('posts.list') }}"
                        class="fr-btn fr-btn--secondary fr-fi-arrow-right-s-line fr-btn--icon-right"
                    >
                        {{ _('All news') }}
                    </a>
                </div>
                {% endif %}
            </div>
        </div>
    </div>
</section>

{% set metrics = [
    (_('Datasets'), 'datasets'),
    (_('Resources'), 'resources'),
    (_('Reuses'), 'reuses'),
    (_('Users'), 'users'),
    (_('Organizations'), 'organizations'),
    (_('Discussions'), 'discussions'),
] %}


{# Metrics Section #}
<section class="metrics-bar">
    <div class="hagrid py-hg py-md-md">
        <div class="bar p-xl">
            <h3>{% include theme('svg/logotype.svg') %} {{ _('is') }}</h3>
            <div class="row-inline justify-between mt-xl mt-md-md">
                {% for (label, metric) in metrics %}
                <div class="filet my-md-xxs">
                    <div class="fs-hg f-bold text-grey-400">{{ current_site.metrics[metric]|format_number }}</div>
                    <span class="text-grey-400">{{ label }}</span>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</section>


{# Datasets section #}
{% set visible_datasets = current_site.settings.home_datasets|visibles %}
{% set nb_datasets = visible_datasets|length %}
{% set dataset_tabs = (
    ('editorial-datasets', _('Featured datasets'), visible_datasets, {}),
    ('recent-datasets', _('Latest datasets'), recent_datasets[:nb_datasets], {'sort': '-created'}),
    ('reference-datasets', _('Reference datasets'), spd_datasets, {}),
) %}

<section class="datasets pb-hg pt-md bg-grey-50">
    <div class="hagrid overflow-visible">
        {# Dataset tabs #}
        <div class="fr-grid-row fr-grid-row--gutters justify-between">
            <div class="fr-col-auto">
                <h2>{{ _('Datasets') }}</h2>
            </div>
            <div class="fr-col-auto fr-grid-row fr-grid-row--gutters">
                <div class="fr-col-auto">
                    <nav class="tabs fr-tags-group fr-displayed-lg">
                        {% for tab_id, label, _, _ in dataset_tabs %}
                        <a
                            href="#{{tab_id}}"
                            class="tab fr-tag {% if loop.first %}active {% endif %}"
                        >
                            {{ label }}
                        </a>
                        {% endfor %}
                    </nav>
                </div>
                <div class="fr-col-auto">
                    <a
                        href="{{ url_for('datasets.list') }}"
                        class="fr-link fr-fi-arrow-right-line fr-link--icon-right"
                    >
                        {{ _('See more') }}
                    </a>
                </div>
            </div>
        </div>
        {% for tab_id, label, datasets, kwargs in dataset_tabs  %}
        <div class="tab-content {% if loop.first %}active{% endif %}" id={{tab_id}}>
            <div class="row pt-xl pt-md-md">
                {% for dataset in datasets %}
                <div class="col-lg-12 col-4">{% include theme('dataset/card.html') %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
        {# end Dataset tabs #}
    </div>
</section>
{# End datasets section #}

{# Reuses section #}
{% set visible_reuses = current_site.settings.home_reuses|visibles %}
{% set nb_reuses = visible_reuses|length %}
{% set reuses_tabs = (
    ('best-reuses', _('Featured reuses'), visible_reuses, {}),
    ('latest-reuses', _('Latest reuses'), recent_reuses[:nb_reuses], {'sort': '-created'}),
) %}

{# Reuse section #}
<section class="reuse py-hg py-md-lg">
    <div class="hagrid">
        <div class="fr-grid-row fr-grid-row--gutters justify-between">
            <div class="fr-col-auto">
                <h2>{{ _('Data reuses') }}</h2>
            </div>
            <div class="fr-col-auto fr-grid-row fr-grid-row--gutters">
                <div class="fr-col-auto">
                    <nav class="tabs fr-tags-group fr-displayed-lg">
                        {% for tab_id, label, _, _ in reuses_tabs %}
                        <a
                            href="#{{tab_id}}"
                            class="tab fr-tag {% if loop.first %}active {% endif %}"
                        >
                            {{ label }}
                        </a>
                        {% endfor %}
                    </nav>
                </div>
                <div class="fr-col-auto">
                    <a
                    href="{{ url_for('reuses.list', sort='-created') }}"
                    title="{{ _('Latest reuses') }}"
                    class="fr-link fr-fi-arrow-right-line fr-link--icon-right"
                >
                    {{ _('See more') }}
                </a>
                </div>
            </div>
        </div>
    </div>
    <div class="hagrid">
        {% for tab_id, label, reuses, kwargs in reuses_tabs  %}
        <div class="tab-content {% if loop.first %}active{% endif %}" id="{{tab_id}}">
            <div class="fr-grid-row fr-grid-row--gutters pt-xl pt-md-md">
                {% for reuse in reuses %}
                <div class="mb-md fr-col-lg-3 fr-col-sm-6 fr-col-12">
                    {% include theme('reuse/card.html') %}
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>
</section>
{# End reuse section #}
{% endcache %}
{% endblock %}
