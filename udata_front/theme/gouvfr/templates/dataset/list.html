{% extends theme("layouts/1-column.html") %}
{% from theme('macros/paginator.html') import paginator with context %}
{% from theme('macros/sort_search.html') import sort_search %}

{% set toolbar_class='search-toolbar' %}

{% block breadcrumb %}
<li class="active">
    {{ _('Datasets') }}
</li>
{% endblock %}

{% set meta = {
    'title': _('Datasets'),
    'description': _("%(site)s dataset search", site=config['SITE_TITLE']),
    'keywords': [_('search'), _('datasets')],
    'robots': 'noindex',
} %}

{% set bundle = 'search' %}

{% block main_content %}
<section
    class="container overflow-visible fr-py-2w vuejs"
>
    <h1 class="fr-mb-1w">{{_('Datasets')}}</h1>
    <p>{{_('Search a dataset on %(site)s', site=current_site.title)}}</p>
    <Search
        :disable-first-search="true"
        data-total-results="{{datasets.total}}"
        data-results="{{ datasets|to_api_format|to_json }}"
    >
    </Search>
    <noscript>
        <div class="pt-sm">
            <form method="GET" class="row-inline fs-lg">
                <span class="icon active">{% include theme("svg/search.svg") %}</span>
                <input type="text" name="q" value="{{datasets.query._query}}" aria-label="{{ _('Search...') }}"
                    placeholder="{{ _('Search...') }}" />
                {{sort_search(datasets,
                    created=(_('Creation date'), 'desc'),
                    reuses=(_('Reuses'), 'desc'),
                    followers=(_('Followers'), 'desc')
                )}}
            </form>
        </div>
        <div class="row-inline pt-xl pt-lg-lg justify-between align-items-center">
            <h1 class="m-0 h2">{{ _('Datasets')}} <sup>{{datasets.total}}</sup></h1>
            <a href="{{ url_for('reuses.list') }}" title="" class="nav-link fs-sm mt-lg-sm">{{ _('Search reuses') }}</a>
        </div>
        <ul class="search-results mt-lg">
            {% for dataset in datasets %}
            <li>
                <a href="{{ url_for('datasets.show', dataset=dataset) }}" title="{{ dataset.title }}"
                    class="unstyled w-100">{% include theme('dataset/search-result.html') %}
                </a>
            </li>
            {% endfor %}
        </ul>
        {{ paginator(datasets) }}
    </noscript>
</section>
{% endblock %}
